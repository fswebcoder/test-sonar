<app-loading [section]="LOADING.sections.receptions" [options]="{ overlay: true, fullscreen: false, size: 'medium' }"></app-loading>

@if (hasData()) {
  <div class="flex align-items-center gap-2 mb-3">
    <span class="text-sm" [class.font-bold]="!useToneladas()">kg</span>
    <p-inputSwitch [ngModel]="useToneladas()" (ngModelChange)="useToneladas.set($event)" />
    <span class="text-sm" [class.font-bold]="useToneladas()">ton</span>
  </div>

  <!-- KPIs Row -->
  <div class="grid mb-2">
    <div class="col-6 md:col-4 lg:col-2">
      <svi-stat-card [value]="dashboard()!.summary.totalRecords" label="Registros" [icon]="ICONS.LIST" variant="primary" size="compact" />
    </div>
    <div class="col-6 md:col-4 lg:col-2">
      <svi-stat-card [value]="formatWeight(dashboard()!.summary.totalNetWeight)" label="Peso Neto" [icon]="ICONS.WEIGHT" variant="secondary" size="compact" />
    </div>
    <div class="col-6 md:col-4 lg:col-2">
      <svi-stat-card [value]="dashboard()!.summary.completedTrips" label="Completados" [icon]="ICONS.CHECK" variant="success" size="compact" />
    </div>
    <div class="col-6 md:col-4 lg:col-2">
      <svi-stat-card [value]="dashboard()!.summary.pendingRecords" label="Pendientes" [icon]="ICONS.CLOCK" variant="warning" size="compact" />
    </div>
    <div class="col-6 md:col-4 lg:col-2">
      <svi-stat-card [value]="dashboard()!.summary.receptions" label="Recepciones" [icon]="ICONS.TRUCK_RAMP" variant="primary" size="compact" />
    </div>
  </div>

  <!-- Row 1: Status + Trends -->
  <div class="grid mb-2">
    <div class="col-12 md:col-4 lg:col-3">
      <div class="card h-full p-2">
        <h6 class="mb-2 mt-0 text-sm">Estado de Recepciones</h6>
        <svi-doughnut-chart [data]="statusDistributionChartData()" height="200px" [compact]="false" />
      </div>
    </div>
    <div class="col-12 md:col-8 lg:col-9">
      <div class="card h-full p-2">
        <h6 class="mb-2 mt-0 text-sm">Tendencia Diaria de Pesajes</h6>
        <svi-line-chart [data]="dailyTrendsChartData()" height="200px" />
      </div>
    </div>
  </div>

  <!-- Row 2: Material + Suppliers -->
  <div class="grid mb-3">
    <div [class]="hasSupplierFilter() ? 'col-12' : 'col-12 lg:col-6'">
      <div class="card h-full p-3">
        <h5 class="mb-2 mt-0">Peso Recibido por Material</h5>
        <svi-bar-chart [data]="materialTypesChartData()" orientation="horizontal" height="250px" />
      </div>
    </div>
    @if (!hasSupplierFilter()) {
      <div class="col-12 lg:col-6">
        <div class="card h-full p-3">
          <h5 class="mb-2 mt-0">Peso Recibido por Proveedor</h5>
          <svi-bar-chart [data]="supplierChartData()" orientation="horizontal" height="250px" />
        </div>
      </div>
    }
  </div>

  <!-- Row 3: Hourly + Mines -->
  <div class="grid">
    <div [class]="hasMineFilter() ? 'col-12' : 'col-12 lg:col-6'">
      <div class="card h-full p-3">
        <h5 class="mb-2 mt-0">Pesajes por Hora</h5>
        <svi-bar-chart [data]="hourlyDistributionChartData()" height="250px" />
      </div>
    </div>
    @if (!hasMineFilter()) {
      <div class="col-12 lg:col-6">
        <div class="card h-full p-3">
          <h5 class="mb-2 mt-0">Peso y Viajes por Mina</h5>
          <svi-grouped-bar-chart
            [data]="mineChartData()"
            height="250px"
            [dualAxis]="true"
            leftAxisLabel="Viajes"
            [rightAxisLabel]="useToneladas() ? 'Peso (ton)' : 'Peso (kg)'"
          />
        </div>
      </div>
    }
  </div>
} @else {
  <svi-empty-state
    title="Sin datos de recepciones"
    description="Aplique los filtros para ver el dashboard de recepciones."
    [icon]="ICONS.TRUCK_RAMP"
  />
}
